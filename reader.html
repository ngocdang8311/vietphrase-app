<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0a0a12" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#f5f3f0" media="(prefers-color-scheme: light)">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>VietPhrase Reader</title>
    <script>try{var t=localStorage.getItem('theme');if(t)document.documentElement.setAttribute('data-theme',t)}catch(e){}</script>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Noto+Serif:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --font: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-read: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            --bg: #0a0a12;
            --bg-subtle: #10101c;
            --surface: rgba(255,255,255,0.04);
            --surface-hover: rgba(255,255,255,0.07);
            --surface-card: rgba(255,255,255,0.06);
            --surface-card-hover: rgba(255,255,255,0.09);
            --border: rgba(255,255,255,0.08);
            --border-focus: rgba(130,120,255,0.4);
            --text: #e8e6f0;
            --text-secondary: rgba(232,230,240,0.55);
            --text-muted: rgba(232,230,240,0.3);
            --accent: #7c6cf0;
            --accent-2: #c084fc;
            --accent-glow: rgba(124,108,240,0.25);
            --green: #4ade80;
            --green-soft: rgba(74,222,128,0.12);
            --orange: #fb923c;
            --orange-soft: rgba(251,146,60,0.12);
            --gradient-btn: linear-gradient(135deg, #6366f1, #8b5cf6, #a855f7);
            --gradient-btn-hover: linear-gradient(135deg, #7577f5, #9b6ff9, #b96bf9);
            --radius: 14px;
            --radius-lg: 20px;
            --shadow: 0 4px 24px rgba(0,0,0,0.3), 0 0 0 1px var(--border);
            --shadow-glow: 0 0 30px var(--accent-glow);
            --ease: cubic-bezier(0.25, 0.1, 0.25, 1);
            --reader-bg: #0a0a12;
            --reader-text: #d4d0e0;
        }

        [data-theme="light"] {
            --bg: #f5f3f0;
            --bg-subtle: #eae7e3;
            --surface: rgba(0,0,0,0.03);
            --surface-hover: rgba(0,0,0,0.06);
            --surface-card: rgba(255,255,255,0.7);
            --surface-card-hover: rgba(255,255,255,0.85);
            --border: rgba(0,0,0,0.08);
            --border-focus: rgba(99,102,241,0.4);
            --text: #1a1a2e;
            --text-secondary: rgba(26,26,46,0.6);
            --text-muted: rgba(26,26,46,0.35);
            --accent: #6366f1;
            --accent-2: #a855f7;
            --accent-glow: rgba(99,102,241,0.15);
            --green: #16a34a;
            --green-soft: rgba(22,163,74,0.1);
            --orange: #ea580c;
            --orange-soft: rgba(234,88,12,0.1);
            --gradient-btn: linear-gradient(135deg, #6366f1, #8b5cf6, #a855f7);
            --gradient-btn-hover: linear-gradient(135deg, #5558e8, #7c4fef, #9945ef);
            --shadow: 0 2px 12px rgba(0,0,0,0.08), 0 0 0 1px var(--border);
            --shadow-glow: 0 0 20px var(--accent-glow);
            --reader-bg: #f5f3f0;
            --reader-text: #2a2a3a;
        }
        [data-theme="light"] .bg-orb { opacity: 0.08; }
        [data-theme="light"] .glass-card, [data-theme="light"] .book-card {
            background: var(--surface-card);
        }

        /* Sepia reader theme — override all vars inside reader overlay */
        [data-reader-theme="sepia"] .reader-overlay {
            --reader-bg: #f4ecd8;
            --reader-text: #5b4636;
            --text: #5b4636;
            --text-secondary: rgba(91,70,54,0.7);
            --text-muted: rgba(91,70,54,0.4);
            --surface: rgba(91,70,54,0.08);
            --surface-hover: rgba(91,70,54,0.12);
            --surface-card: rgba(255,255,255,0.5);
            --border: rgba(91,70,54,0.15);
            --accent: #7c5e3c;
            --accent-2: #9b6b3a;
        }
        /* Light theme also needs reader overlay vars when in default reader theme */
        [data-theme="light"] .reader-overlay {
            --text: #1a1a2e;
            --text-secondary: rgba(26,26,46,0.6);
            --text-muted: rgba(26,26,46,0.35);
            --surface: rgba(0,0,0,0.04);
            --surface-hover: rgba(0,0,0,0.07);
            --border: rgba(0,0,0,0.1);
        }

        /* Immersive mode — hide bars on tap */
        .reader-overlay.immersive .reader-topbar,
        .reader-overlay.immersive .reader-settings,
        .reader-overlay.immersive .reader-bottomnav,
        .reader-overlay.immersive .scroll-progress {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s var(--ease);
        }
        .reader-topbar,
        .reader-settings,
        .reader-bottomnav,
        .scroll-progress {
            transition: opacity 0.3s var(--ease);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html { height: 100%; }
        body {
            min-height: 100%;
            font-family: var(--font);
            font-size: 15px;
            color: var(--text);
            background: var(--bg);
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        .bg-ambient { position: fixed; inset: 0; z-index: 0; pointer-events: none; overflow: hidden; }
        .bg-orb { position: absolute; border-radius: 50%; filter: blur(100px); opacity: 0.35; animation: orbFloat 20s ease-in-out infinite alternate; }
        .bg-orb-1 { width: 600px; height: 600px; background: radial-gradient(circle, #6366f1, transparent 70%); top: -200px; left: -100px; }
        .bg-orb-2 { width: 500px; height: 500px; background: radial-gradient(circle, #a855f7, transparent 70%); bottom: -150px; right: -100px; animation-delay: -7s; }
        @keyframes orbFloat {
            0% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(30px, -20px) scale(1.05); }
            100% { transform: translate(-10px, 10px) scale(1.02); }
        }
        .bg-noise { position: fixed; inset: 0; z-index: 0; pointer-events: none; opacity: 0.025; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E"); background-repeat: repeat; background-size: 256px; }
        .hidden { display: none !important; }

        /* App shell */
        .app {
            position: relative; z-index: 1;
            max-width: 1060px; margin: 0 auto;
            min-height: 100vh; display: flex; flex-direction: column;
            padding: 24px;
            padding-top: calc(env(safe-area-inset-top, 0px) + 12px);
        }

        /* Header */
        .header {
            display: flex; align-items: center; gap: 12px;
            margin-bottom: 24px; flex-wrap: wrap;
        }
        .header-title {
            font-size: 22px; font-weight: 800;
            background: linear-gradient(135deg, #e8e6f0, var(--accent), var(--accent-2));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        }
        [data-theme="light"] .header-title {
            background: linear-gradient(135deg, #1a1a2e, var(--accent), var(--accent-2));
            -webkit-background-clip: text; background-clip: text;
        }
        .header-spacer { flex: 1; }
        .header-link {
            font-size: 13px; font-weight: 600; color: var(--text-secondary);
            text-decoration: none; padding: 8px 14px;
            background: var(--surface-card); border: 1px solid var(--border);
            border-radius: 10px; transition: all 0.2s var(--ease);
        }
        .header-link:hover { background: var(--surface-card-hover); color: var(--text); }
        .header-btn {
            width: 36px; height: 36px; border-radius: 10px;
            background: var(--surface-card); border: 1px solid var(--border);
            color: var(--text); font-size: 18px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s var(--ease); line-height: 1;
        }
        .header-btn:hover { background: var(--surface-card-hover); }

        /* Toolbar */
        .toolbar {
            display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; align-items: center;
        }
        .btn {
            border: none; border-radius: 10px; font-family: var(--font);
            font-weight: 600; cursor: pointer; display: inline-flex;
            align-items: center; justify-content: center; gap: 7px;
            transition: all 0.2s var(--ease); font-size: 13px; padding: 10px 18px;
        }
        .btn:active { transform: scale(0.96); }
        .btn-accent { background: rgba(124,108,240,0.12); color: var(--accent-2); }
        .btn-accent:hover { background: rgba(124,108,240,0.22); }
        .btn-default { background: var(--surface-card); border: 1px solid var(--border); color: var(--text-secondary); }
        .btn-default:hover { background: var(--surface-card-hover); color: var(--text); }
        .btn-red { background: rgba(255,59,48,0.1); color: #ff6b6b; }
        .btn-red:hover { background: rgba(255,59,48,0.18); }
        .btn-green { background: var(--green-soft); color: var(--green); }
        .btn-green:hover { background: rgba(74,222,128,0.2); }

        /* Storage info */
        .storage-info {
            font-size: 12px; color: var(--text-muted); margin-left: auto;
        }

        /* Book grid */
        .book-grid { display: flex; flex-direction: column; gap: 10px; }
        .book-card {
            display: flex; align-items: center; gap: 16px;
            padding: 18px 20px;
            background: var(--surface-card); border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            transition: all 0.2s var(--ease); cursor: default;
        }
        .book-card:hover { border-color: var(--border-focus); }
        .book-icon { font-size: 32px; opacity: 0.5; flex-shrink: 0; }
        .book-info { flex: 1; min-width: 0; }
        .book-title {
            font-size: 15px; font-weight: 700; color: var(--text);
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .book-meta {
            font-size: 12px; color: var(--text-muted); margin-top: 3px;
        }
        .book-progress {
            font-size: 12px; color: var(--accent-2); font-weight: 600; margin-top: 2px;
        }
        .book-actions { display: flex; gap: 6px; flex-shrink: 0; }

        .empty-state {
            text-align: center; padding: 60px 20px; color: var(--text-muted);
        }
        .empty-icon { font-size: 48px; opacity: 0.3; margin-bottom: 12px; }
        .empty-title { font-size: 16px; font-weight: 600; color: var(--text-secondary); }
        .empty-sub { font-size: 13px; margin-top: 6px; }

        /* ===== Reader Overlay ===== */
        .reader-overlay {
            position: fixed; inset: 0; z-index: 50;
            background: var(--reader-bg);
            display: flex; flex-direction: column;
            transition: opacity 0.3s var(--ease);
        }
        .reader-overlay.hidden { display: none !important; }

        /* Reader top bar */
        .reader-topbar {
            display: flex; align-items: center; gap: 10px;
            padding: 10px 16px;
            background: var(--reader-bg);
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }
        .reader-topbar .btn { padding: 8px 12px; }
        .reader-book-title {
            flex: 1; font-size: 14px; font-weight: 600;
            color: var(--reader-text); white-space: nowrap;
            overflow: hidden; text-overflow: ellipsis;
        }
        .reader-chapter-btn {
            font-size: 13px; font-weight: 600;
            padding: 6px 14px; border-radius: 8px;
            background: var(--surface); border: 1px solid var(--border);
            color: var(--text-secondary); cursor: pointer;
            font-family: var(--font); transition: all 0.2s;
        }
        .reader-chapter-btn:hover { background: var(--surface-hover); color: var(--text); }

        /* Settings bar */
        .reader-settings {
            display: flex; align-items: center; gap: 10px;
            padding: 8px 16px;
            background: var(--reader-bg);
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap; flex-shrink: 0;
        }
        .reader-settings.hidden { display: none !important; }
        .settings-group {
            display: flex; align-items: center; gap: 6px;
            font-size: 13px; color: var(--text-secondary);
        }
        .settings-group label { font-weight: 600; white-space: nowrap; }
        .settings-btn {
            width: 30px; height: 30px; border-radius: 8px;
            background: var(--surface); border: 1px solid var(--border);
            color: var(--text); font-size: 14px; font-weight: 700;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-family: var(--font); transition: all 0.15s;
        }
        .settings-btn:hover { background: var(--surface-hover); }
        .settings-btn:active { transform: scale(0.92); }
        .settings-val {
            font-size: 12px; font-weight: 600; min-width: 28px;
            text-align: center; color: var(--text);
        }
        .settings-sep {
            width: 1px; height: 20px; background: var(--border); margin: 0 4px;
        }
        .theme-select {
            padding: 5px 10px; border-radius: 8px;
            background: var(--surface); border: 1px solid var(--border);
            color: var(--text); font-size: 12px; font-family: var(--font);
            cursor: pointer;
        }
        .font-select {
            padding: 5px 10px; border-radius: 8px;
            background: var(--surface); border: 1px solid var(--border);
            color: var(--text); font-size: 12px; font-family: var(--font);
            cursor: pointer;
        }

        /* Reader content area */
        .reader-content-wrap {
            flex: 1; overflow-y: auto; overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }
        .reader-content {
            max-width: 760px; margin: 0 auto;
            padding: 32px 24px 80px;
            font-family: var(--font-read);
            font-size: 18px; line-height: 1.8;
            color: var(--reader-text);
            word-wrap: break-word;
        }
        .reader-content p {
            margin-bottom: 0.8em;
            text-indent: 0;
        }
        .reader-content p:empty { margin-bottom: 0.4em; }

        /* Scroll progress bar */
        .scroll-progress {
            position: sticky; top: 0; z-index: 2;
            height: 3px; background: var(--border);
            flex-shrink: 0;
        }
        .scroll-progress-bar {
            height: 100%; background: var(--accent);
            transition: width 0.1s linear; width: 0%;
        }

        /* Bottom nav */
        .reader-bottomnav {
            display: flex; align-items: center; justify-content: center;
            gap: 16px; padding: 12px 16px;
            background: var(--reader-bg);
            border-top: 1px solid var(--border);
            flex-shrink: 0;
        }
        .reader-bottomnav .btn { min-width: 100px; }
        .chapter-indicator {
            font-size: 13px; font-weight: 600;
            color: var(--text-secondary); min-width: 100px; text-align: center;
        }
        .scroll-indicator {
            font-size: 13px; font-weight: 600;
            color: var(--text-secondary);
        }

        /* Chapter sidebar */
        .chapter-sidebar {
            position: fixed; top: 0; left: 0; bottom: 0;
            width: 300px; max-width: 85vw;
            background: var(--bg); border-right: 1px solid var(--border);
            z-index: 60; transform: translateX(-100%);
            transition: transform 0.3s var(--ease);
            display: flex; flex-direction: column;
        }
        .chapter-sidebar.open { transform: translateX(0); }
        .chapter-sidebar-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 16px; border-bottom: 1px solid var(--border);
            font-size: 14px; font-weight: 700;
        }
        .chapter-list {
            flex: 1; overflow-y: auto; padding: 8px;
        }
        .chapter-item {
            padding: 10px 14px; border-radius: 10px;
            font-size: 13px; color: var(--text-secondary);
            cursor: pointer; transition: all 0.15s;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .chapter-item:hover { background: var(--surface-hover); color: var(--text); }
        .chapter-item.active {
            background: rgba(124,108,240,0.12); color: var(--accent-2); font-weight: 600;
        }
        .sidebar-backdrop {
            position: fixed; inset: 0; z-index: 55;
            background: rgba(0,0,0,0.5); opacity: 0;
            transition: opacity 0.3s; pointer-events: none;
        }
        .sidebar-backdrop.open { opacity: 1; pointer-events: auto; }

        /* Backup modal */
        .modal-backdrop {
            position: fixed; inset: 0; z-index: 70;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(8px);
            display: flex; align-items: center; justify-content: center;
            padding: 20px;
        }
        .modal-backdrop.hidden { display: none !important; }
        .modal {
            background: var(--bg); border: 1px solid var(--border);
            border-radius: var(--radius-lg); padding: 24px;
            max-width: 420px; width: 100%;
        }
        .modal-title { font-size: 16px; font-weight: 700; margin-bottom: 16px; }
        .modal-body { display: flex; flex-direction: column; gap: 10px; }
        .modal-body .btn { width: 100%; justify-content: center; padding: 12px; }
        .modal-status { font-size: 13px; color: var(--text-secondary); margin-top: 8px; }

        /* Sync button states */
        .header-btn.syncing {
            animation: syncSpin 1s linear infinite;
        }
        @keyframes syncSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .header-btn.connected { color: var(--green); }
        .sync-status {
            font-size: 11px;
            color: var(--text-muted);
            margin-left: 4px;
        }

        /* Cloud book card */
        .book-card.cloud-only {
            border-style: dashed;
            border-color: var(--accent);
            opacity: 0.85;
        }
        .book-card.cloud-only .book-icon { opacity: 0.3; }
        .cloud-badge {
            font-size: 10px;
            font-weight: 700;
            color: var(--accent-2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* EPUB: foliate-view replaces old iframe */
        foliate-view {
            width: 100%; height: 100%;
            display: none;
        }
        .reader-content-wrap.epub-active foliate-view {
            display: block;
        }
        .reader-content-wrap.epub-active #readerContent {
            display: none;
        }
        .reader-content-wrap.epub-active {
            overflow: hidden;
        }

        /* ===== Tab Bar ===== */
        .tab-bar {
            display: flex; gap: 4px;
            padding: 4px; margin-bottom: 20px;
            background: var(--surface); border: 1px solid var(--border);
            border-radius: 12px; width: fit-content;
        }
        .tab-btn {
            padding: 8px 20px; border: none; border-radius: 9px;
            font-family: var(--font); font-size: 13px; font-weight: 600;
            color: var(--text-secondary); background: transparent;
            cursor: pointer; transition: all 0.2s var(--ease);
        }
        .tab-btn:hover { color: var(--text); background: var(--surface-hover); }
        .tab-btn.active {
            background: var(--gradient-btn); color: #fff;
            box-shadow: 0 2px 8px var(--accent-glow);
        }

        /* ===== Crawler Styles ===== */
        .crawler-shell { min-height: 60vh; }
        .crawler-topbar {
            display: flex; gap: 8px; margin-bottom: 16px;
            align-items: center; flex-wrap: wrap;
        }
        .crawler-url-input {
            flex: 1; min-width: 200px; padding: 10px 14px;
            border-radius: 10px; border: 1px solid var(--border);
            background: var(--surface); color: var(--text);
            font-family: var(--font); font-size: 13px;
            outline: none; transition: border-color 0.2s;
        }
        .crawler-url-input:focus { border-color: var(--border-focus); }
        .crawler-url-input::placeholder { color: var(--text-muted); }
        .crawler-site-select {
            padding: 10px 12px; border-radius: 10px;
            background: var(--surface); border: 1px solid var(--border);
            color: var(--text); font-size: 12px; font-family: var(--font);
            cursor: pointer;
        }
        .crawler-back-btn { padding: 8px 12px !important; }

        .crawler-main {
            display: flex; gap: 16px; min-height: 400px;
        }
        .crawler-sidebar {
            width: 260px; min-width: 220px; flex-shrink: 0;
            background: var(--surface-card); border: 1px solid var(--border);
            border-radius: var(--radius); display: flex; flex-direction: column;
            max-height: 70vh; position: sticky; top: 20px;
        }
        .crawler-sidebar-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 12px 14px; border-bottom: 1px solid var(--border);
            font-size: 13px; font-weight: 700;
        }
        .crawler-sidebar-close { display: none; }
        .crawler-chapter-list {
            flex: 1; overflow-y: auto; padding: 6px;
        }
        .crawler-ch-item {
            padding: 8px 12px; border-radius: 8px;
            font-size: 12px; color: var(--text-secondary);
            cursor: pointer; transition: all 0.15s;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            display: flex; justify-content: space-between; align-items: center;
        }
        .crawler-ch-item:hover { background: var(--surface-hover); color: var(--text); }
        .crawler-ch-item.active {
            background: rgba(124,108,240,0.12); color: var(--accent-2); font-weight: 600;
        }
        .crawler-ch-saved { color: var(--green); font-size: 11px; margin-left: 4px; flex-shrink: 0; }
        .crawler-content-area { flex: 1; min-width: 0; }
        .crawler-content {
            max-width: 760px; margin: 0 auto;
            font-family: var(--font-read); font-size: 18px; line-height: 1.8;
            color: var(--text); word-wrap: break-word;
        }
        .crawler-content p { margin-bottom: 0.8em; }
        .crawler-content p:empty { margin-bottom: 0.4em; }
        .crawler-content p[data-zh] { cursor: help; }
        .crawler-content p[data-zh]:hover { background: var(--surface); border-radius: 4px; }

        .crawler-chapter-title {
            font-size: 20px; font-weight: 700; margin-bottom: 16px;
            color: var(--text); padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }
        .crawler-index-title {
            font-size: 22px; font-weight: 800; margin-bottom: 8px;
            background: linear-gradient(135deg, var(--text), var(--accent));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        }
        .crawler-index-info {
            font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;
        }
        .crawler-index-list {
            display: flex; flex-direction: column; gap: 2px;
        }
        .crawler-index-link {
            display: block; padding: 10px 14px;
            font-size: 14px; color: var(--text-secondary);
            text-decoration: none; border-radius: 8px;
            transition: all 0.15s;
        }
        .crawler-index-link:hover { background: var(--surface-hover); color: var(--accent-2); }

        .crawler-bottombar {
            display: flex; gap: 8px; align-items: center;
            justify-content: center; padding: 16px 0; margin-top: 8px;
            border-top: 1px solid var(--border); flex-wrap: wrap;
        }

        .crawler-loading {
            display: flex; align-items: center; gap: 10px;
            justify-content: center; padding: 60px 20px;
            color: var(--text-secondary); font-size: 14px;
        }
        .crawler-spinner {
            width: 20px; height: 20px; border: 2px solid var(--border);
            border-top-color: var(--accent); border-radius: 50%;
            animation: syncSpin 0.8s linear infinite;
        }

        /* ===== Crawler: Site Grid + Cards ===== */
        .crawler-section-title {
            display: flex; align-items: center; gap: 8px;
            font-size: 15px; font-weight: 700; color: var(--text);
            margin-bottom: 12px;
        }
        .crawler-site-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 10px;
        }
        .crawler-site-card {
            display: flex; flex-direction: column; align-items: center; gap: 6px;
            padding: 20px 12px; border-radius: var(--radius);
            background: var(--surface-card); border: 1px solid var(--border);
            cursor: pointer; transition: all 0.2s var(--ease);
            position: relative; text-align: center;
        }
        .crawler-site-card:hover {
            border-color: var(--border-focus);
            transform: translateY(-2px);
            box-shadow: var(--shadow-glow);
        }
        .crawler-site-card.disabled {
            opacity: 0.45; cursor: not-allowed;
            filter: grayscale(0.5);
        }
        .crawler-site-card.disabled:hover {
            transform: none; box-shadow: none;
            border-color: var(--border);
        }
        .crawler-site-card-icon { font-size: 32px; }
        .crawler-site-card-name {
            font-size: 14px; font-weight: 700; color: var(--text);
        }
        .crawler-site-card-url {
            font-size: 11px; color: var(--text-muted);
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            max-width: 100%;
        }
        .crawler-site-card-badge {
            position: absolute; top: 8px; right: 8px;
            font-size: 9px; font-weight: 700; text-transform: uppercase;
            color: var(--orange); background: var(--orange-soft);
            padding: 2px 6px; border-radius: 4px; letter-spacing: 0.5px;
        }

        /* ===== Crawler: Site Home ===== */
        .crawler-site-home-header {
            display: flex; align-items: center; gap: 10px;
            margin-bottom: 20px; padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }
        .crawler-site-home-name {
            font-size: 18px; font-weight: 800;
        }

        /* Category pills */
        .crawler-cat-grid {
            display: flex; flex-wrap: wrap; gap: 8px;
        }
        .crawler-cat-pill {
            padding: 8px 16px; border-radius: 20px;
            background: var(--surface-card); border: 1px solid var(--border);
            color: var(--text-secondary); font-size: 13px; font-weight: 600;
            font-family: var(--font); cursor: pointer;
            transition: all 0.2s var(--ease);
        }
        .crawler-cat-pill:hover {
            background: rgba(124,108,240,0.12); color: var(--accent-2);
            border-color: var(--border-focus);
        }

        /* Ranking tabs */
        .crawler-rank-tabs {
            display: flex; gap: 4px; padding: 4px;
            background: var(--surface); border: 1px solid var(--border);
            border-radius: 10px; width: fit-content; margin-bottom: 16px;
            flex-wrap: wrap;
        }
        .crawler-rank-tab {
            padding: 6px 14px; border: none; border-radius: 7px;
            font-family: var(--font); font-size: 12px; font-weight: 600;
            color: var(--text-secondary); background: transparent;
            cursor: pointer; transition: all 0.2s var(--ease);
        }
        .crawler-rank-tab:hover { color: var(--text); background: var(--surface-hover); }
        .crawler-rank-tab.active {
            background: var(--gradient-btn); color: #fff;
            box-shadow: 0 2px 8px var(--accent-glow);
        }

        /* Novel grid / browse cards */
        .crawler-novel-grid {
            display: flex; flex-direction: column; gap: 8px;
        }
        .crawler-browse-card {
            padding: 14px 18px; border-radius: var(--radius);
            background: var(--surface-card); border: 1px solid var(--border);
            cursor: pointer; transition: all 0.2s var(--ease);
        }
        .crawler-browse-card:hover {
            border-color: var(--border-focus);
            background: var(--surface-card-hover);
        }
        .crawler-browse-card-title {
            font-size: 14px; font-weight: 700; color: var(--text);
            margin-bottom: 2px;
        }
        .crawler-browse-card-author {
            font-size: 12px; color: var(--accent-2); font-weight: 600;
            margin-bottom: 4px;
        }
        .crawler-browse-card-desc {
            font-size: 12px; color: var(--text-muted); line-height: 1.4;
            display: -webkit-box; -webkit-line-clamp: 2;
            -webkit-box-orient: vertical; overflow: hidden;
        }

        /* Pagination */
        .crawler-pagination {
            display: flex; align-items: center; justify-content: center;
            gap: 4px; padding: 16px 0; flex-wrap: wrap;
        }
        .crawler-page-btn {
            min-width: 36px; height: 36px; padding: 0 10px;
            border-radius: 8px; border: 1px solid var(--border);
            background: var(--surface-card); color: var(--text-secondary);
            font-family: var(--font); font-size: 13px; font-weight: 600;
            cursor: pointer; transition: all 0.15s var(--ease);
        }
        .crawler-page-btn:hover {
            background: var(--surface-card-hover); color: var(--text);
        }
        .crawler-page-btn.active {
            background: var(--gradient-btn); color: #fff;
            border-color: transparent;
        }
        .crawler-page-next { padding: 0 14px; }

        /* List header */
        .crawler-list-header {
            display: flex; align-items: center; gap: 10px;
            margin-bottom: 16px; padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }
        .crawler-list-title {
            font-size: 16px; font-weight: 700;
        }

        /* Novel cards (saved) */
        .crawler-novels-header {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 16px;
        }
        .crawler-novels-title { font-size: 18px; font-weight: 700; }
        .crawler-novel-card {
            display: flex; align-items: center; gap: 16px;
            padding: 16px 20px; margin-bottom: 8px;
            background: var(--surface-card); border: 1px solid var(--border);
            border-radius: var(--radius); transition: all 0.2s var(--ease);
        }
        .crawler-novel-card:hover { border-color: var(--border-focus); }
        .crawler-novel-info { flex: 1; min-width: 0; }
        .crawler-novel-name {
            font-size: 15px; font-weight: 700;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .crawler-novel-meta { font-size: 12px; color: var(--text-muted); margin-top: 3px; }
        .crawler-novel-actions { display: flex; gap: 6px; flex-shrink: 0; }

        /* Edit modal */
        .crawler-edit-modal {
            position: fixed; inset: 0; z-index: 80;
            display: flex; align-items: center; justify-content: center;
        }
        .crawler-edit-modal.hidden { display: none !important; }
        .crawler-edit-overlay {
            position: absolute; inset: 0;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(8px);
        }
        .crawler-edit-box {
            position: relative; z-index: 1;
            background: var(--bg); border: 1px solid var(--border);
            border-radius: var(--radius-lg); padding: 20px;
            width: 90vw; max-width: 900px; max-height: 85vh;
            display: flex; flex-direction: column;
        }
        .crawler-edit-header {
            display: flex; align-items: center; justify-content: space-between;
            font-size: 15px; font-weight: 700; margin-bottom: 12px;
        }
        .crawler-edit-body {
            flex: 1; display: flex; gap: 12px;
            min-height: 0; overflow: hidden;
        }
        .crawler-edit-col { flex: 1; display: flex; flex-direction: column; }
        .crawler-edit-col label {
            font-size: 12px; font-weight: 600;
            color: var(--text-secondary); margin-bottom: 6px;
        }
        .crawler-edit-col textarea {
            flex: 1; min-height: 300px; padding: 12px;
            border-radius: 10px; border: 1px solid var(--border);
            background: var(--surface); color: var(--text);
            font-family: var(--font-read); font-size: 14px; line-height: 1.6;
            resize: none;
        }
        .crawler-edit-col textarea:focus { border-color: var(--border-focus); outline: none; }
        .crawler-edit-footer {
            display: flex; gap: 8px; justify-content: flex-end;
            margin-top: 12px;
        }

        /* Responsive */
        @media (max-width: 700px) {
            .app { padding: 16px; padding-top: calc(env(safe-area-inset-top, 0px) + 16px); }
            .header { gap: 8px; }
            .header-title { font-size: 18px; }
            .book-card { padding: 14px 16px; gap: 12px; }
            .book-icon { font-size: 26px; }
            .reader-content { padding: 24px 18px 60px; font-size: 17px; }
            .reader-bottomnav .btn { min-width: 80px; font-size: 12px; padding: 8px 12px; }
            /* Crawler mobile */
            .crawler-main { flex-direction: column; }
            .crawler-sidebar {
                position: fixed; top: 0; left: 0; bottom: 0;
                width: 280px; max-width: 85vw; z-index: 65;
                border-radius: 0; border-right: 1px solid var(--border);
                transform: translateX(-100%); transition: transform 0.3s var(--ease);
                max-height: none;
            }
            .crawler-sidebar:not(.hidden) { transform: translateX(0); }
            .crawler-sidebar.hidden { transform: translateX(-100%); }
            .crawler-sidebar-close { display: block; }
            .crawler-edit-body { flex-direction: column; }
            /* New crawler views mobile */
            .crawler-site-grid { grid-template-columns: repeat(2, 1fr); gap: 8px; }
            .crawler-site-card { padding: 16px 10px; }
            .crawler-site-card-icon { font-size: 26px; }
            .crawler-site-card-name { font-size: 13px; }
            .crawler-cat-pill { padding: 6px 12px; font-size: 12px; }
            .crawler-rank-tabs { width: 100%; }
            .crawler-browse-card { padding: 12px 14px; }
            .crawler-browse-card-title { font-size: 13px; }
        }
    </style>
</head>
<body>
    <div class="bg-ambient">
        <div class="bg-orb bg-orb-1"></div>
        <div class="bg-orb bg-orb-2"></div>
    </div>
    <div class="bg-noise"></div>

    <!-- ===== Library View ===== -->
    <div class="app" id="libraryView">
        <div class="header">
            <div class="header-title">VietPhrase Reader</div>
            <div class="header-spacer"></div>
            <a href="index.html" class="header-link">&larr; Trang d&#7883;ch</a>
            <button class="header-btn" id="btnSync" title="Cloud Sync">&#x2601;</button>
            <button class="header-btn" id="btnBackup" title="Backup / Restore">&#x1F4BE;</button>
            <button class="header-btn" id="btnTheme" title="Toggle theme">&#x1F319;</button>
        </div>

        <div class="tab-bar" id="mainTabBar">
            <button class="tab-btn active" data-tab="library">Th&#432; vi&#7879;n</button>
            <button class="tab-btn" data-tab="crawler">Duy&#7879;t truy&#7879;n</button>
        </div>

        <div class="toolbar" id="libraryToolbar">
            <button class="btn btn-accent" id="btnImportBook">Import s&#225;ch</button>
            <input type="file" id="bookFileInput" accept=".txt,.html,.htm,.epub,.mobi,.azw,.azw3,.fb2,.fbz,.cbz" multiple style="display:none">
            <span class="storage-info" id="storageInfo"></span>
        </div>

        <div class="book-grid" id="bookGrid"></div>

        <div class="empty-state hidden" id="emptyState">
            <div class="empty-icon">&#x1F4DA;</div>
            <div class="empty-title">Ch&#432;a c&#243; s&#225;ch n&#224;o</div>
            <div class="empty-sub">Import file .txt, .html, .epub, .mobi, .fb2, .cbz &#273;&#7875; b&#7855;t &#273;&#7847;u &#273;&#7885;c</div>
        </div>

        <!-- Crawler View (lazy-loaded) -->
        <div class="hidden" id="crawlerView">
            <div id="crawlerRoot"></div>
        </div>

        <footer style="text-align:center;padding:24px 0 12px;font-size:12px;color:var(--text-muted)">
            <a href="privacy.html" style="color:var(--text-secondary);text-decoration:none">Privacy Policy</a>
        </footer>
    </div>

    <!-- ===== Reader Overlay ===== -->
    <div class="reader-overlay hidden" id="readerOverlay">
        <div class="reader-topbar">
            <button class="btn btn-default" id="btnBackToLib">&larr; Quay l&#7841;i</button>
            <div class="reader-book-title" id="readerBookTitle"></div>
            <button class="reader-chapter-btn hidden" id="btnChapterList">Ch&#432;&#417;ng &#x25BE;</button>
            <button class="btn btn-default" id="btnSettings">Aa</button>
        </div>
        <div class="reader-settings hidden" id="readerSettingsBar">
            <div class="settings-group">
                <label>C&#7905;</label>
                <button class="settings-btn" id="btnFontDown">A-</button>
                <span class="settings-val" id="valFontSize">18</span>
                <button class="settings-btn" id="btnFontUp">A+</button>
            </div>
            <div class="settings-sep"></div>
            <div class="settings-group">
                <label>D&#227;n</label>
                <button class="settings-btn" id="btnLineDown">-</button>
                <span class="settings-val" id="valLineHeight">1.8</span>
                <button class="settings-btn" id="btnLineUp">+</button>
            </div>
            <div class="settings-sep"></div>
            <div class="settings-group">
                <label>Font</label>
                <select class="font-select" id="selFont">
                    <option value="sans">Sans-serif</option>
                    <option value="serif">Serif</option>
                </select>
            </div>
            <div class="settings-sep"></div>
            <div class="settings-group">
                <label>Theme</label>
                <select class="theme-select" id="selReaderTheme">
                    <option value="default">Auto</option>
                    <option value="sepia">Sepia</option>
                </select>
            </div>
        </div>
        <div class="scroll-progress"><div class="scroll-progress-bar" id="scrollProgressBar"></div></div>
        <div class="reader-content-wrap" id="readerContentWrap">
            <div class="reader-content" id="readerContent"></div>
        </div>
        <div class="reader-bottomnav" id="readerBottomNav">
            <button class="btn btn-default hidden" id="btnPrevCh">&larr; Tr&#432;&#7899;c</button>
            <span class="chapter-indicator hidden" id="chapterIndicator"></span>
            <span class="scroll-indicator hidden" id="scrollIndicator"></span>
            <button class="btn btn-default hidden" id="btnNextCh">Ti&#7871;p &rarr;</button>
        </div>
    </div>

    <!-- Chapter sidebar -->
    <div class="sidebar-backdrop" id="sidebarBackdrop"></div>
    <div class="chapter-sidebar" id="chapterSidebar">
        <div class="chapter-sidebar-header">
            <span>M&#7909;c l&#7909;c</span>
            <button class="btn btn-default" id="btnCloseSidebar">&times;</button>
        </div>
        <div class="chapter-list" id="chapterList"></div>
    </div>

    <!-- Sync modal -->
    <div class="modal-backdrop hidden" id="syncModal">
        <div class="modal">
            <div class="modal-title">Cloud Sync</div>
            <div class="modal-body">
                <div id="syncStatusMsg" style="font-size:13px;color:var(--text-secondary);margin-bottom:8px"></div>
                <div id="syncConnected" class="hidden">
                    <div id="syncProviderBadge" style="font-size:11px;color:var(--text-muted);margin-bottom:8px;text-align:center"></div>
                    <button class="btn btn-accent" id="btnDoSync" style="width:100%;padding:12px;margin-bottom:8px">Sync Now</button>
                    <div id="syncCloudBooks" style="margin-top:8px"></div>
                    <button class="btn btn-red" id="btnDisconnect" style="width:100%;padding:10px;margin-top:12px;font-size:12px">Ng&#7855;t k&#7871;t n&#7889;i</button>
                </div>
                <div id="syncDisconnected">
                    <div style="display:flex;gap:8px;margin-bottom:8px">
                        <button class="btn btn-accent" id="btnConnectGoogle" style="flex:1;padding:12px">Google Drive</button>
                        <button class="btn btn-accent" id="btnConnectGithub" style="flex:1;padding:12px">GitHub Gist</button>
                    </div>
                    <div id="deviceFlowUI" class="hidden" style="text-align:center;padding:12px;background:var(--surface);border:1px solid var(--border);border-radius:10px;margin-bottom:8px">
                        <div style="font-size:12px;color:var(--text-secondary);margin-bottom:8px">Nh&#7853;p m&#227; n&#224;y t&#7841;i GitHub:</div>
                        <div id="deviceFlowCode" style="font-size:28px;font-weight:800;letter-spacing:4px;color:var(--accent-2);margin-bottom:8px;font-family:monospace"></div>
                        <a id="deviceFlowLink" href="https://github.com/login/device" target="_blank" rel="noopener" style="color:var(--accent);font-size:13px;font-weight:600">M&#7903; github.com/login/device &rarr;</a>
                        <div style="font-size:11px;color:var(--text-muted);margin-top:8px">&#272;ang ch&#7901; x&#225;c nh&#7853;n...</div>
                        <button class="btn btn-default" id="btnCancelDevice" style="margin-top:8px;padding:6px 14px;font-size:12px">H&#7911;y</button>
                    </div>
                    <div style="font-size:11px;color:var(--text-muted);margin-top:8px;text-align:center">&#272;&#7891;ng b&#7897; s&#225;ch, ti&#7871;n tr&#236;nh &#273;&#7885;c, c&#224;i &#273;&#7863;t gi&#7919;a c&#225;c thi&#7871;t b&#7883;</div>
                </div>
                <button class="btn btn-default" id="btnCloseSync" style="width:100%;padding:10px;margin-top:8px">&#272;&#243;ng</button>
            </div>
        </div>
    </div>

    <!-- Backup modal -->
    <div class="modal-backdrop hidden" id="backupModal">
        <div class="modal">
            <div class="modal-title">Backup / Restore</div>
            <div class="modal-body">
                <button class="btn btn-accent" id="btnExportBackup">Export Backup (.zip)</button>
                <button class="btn btn-default" id="btnImportBackup">Import Backup (.zip/.json)</button>
                <input type="file" id="backupFileInput" accept=".zip,.json" style="display:none">
                <div class="modal-status" id="backupStatus"></div>
                <button class="btn btn-default" id="btnCloseBackup">&#272;&#243;ng</button>
            </div>
        </div>
    </div>

    <script src="https://accounts.google.com/gsi/client" async defer onload="window.__onGisLoaded && window.__onGisLoaded()"></script>
    <script type="module" src="epub-bridge.js"></script>
    <script src="utils.js"></script>
    <script src="reader-lib.js"></script>
    <script src="sync-common.js"></script>
    <script src="cloud-sync.js"></script>
    <script src="github-sync.js"></script>
    <script src="dict-engine.js"></script>
    <script src="backup.js"></script>
    <script src="reader-app.js"></script>
</body>
</html>
